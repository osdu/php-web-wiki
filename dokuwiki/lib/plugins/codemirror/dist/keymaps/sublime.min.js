(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/edit/matchbrackets"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/edit/matchbrackets"],a);else a(CodeMirror)})(function(a){"use strict";var b=a.keyMap.sublime={fallthrough:"default"};var c=a.commands;var d=a.Pos;var e=a.keyMap["default"]==a.keyMap.macDefault;var f=e?"Cmd-":"Ctrl-";function g(b,c,e){if(e<0&&c.ch==0)return b.clipPos(d(c.line-1));var f=b.getLine(c.line);if(e>0&&c.ch>=f.length)return b.clipPos(d(c.line+1,0));var g="start",h;for(var i=c.ch,j=e<0?0:f.length,k=0;i!=j;i+=e,k++){var l=f.charAt(e<0?i-1:i);var m=l!="_"&&a.isWordChar(l)?"w":"o";if(m=="w"&&l.toUpperCase()==l)m="W";if(g=="start"){if(m!="o"){g="in";h=m}}else if(g=="in"){if(h!=m){if(h=="w"&&m=="W"&&e<0)i--;if(h=="W"&&m=="w"&&e>0){h="w";continue}break}}}return d(c.line,i)}function h(a,b){a.extendSelectionsBy(function(c){if(a.display.shift||a.doc.extend||c.empty())return g(a.doc,c.head,b);else return b<0?c.from():c.to()})}var i=e?"Ctrl-":"Alt-";c[b[i+"Left"]="goSubwordLeft"]=function(a){h(a,-1)};c[b[i+"Right"]="goSubwordRight"]=function(a){h(a,1)};if(e)b["Cmd-Left"]="goLineStartSmart";var j=e?"Ctrl-Alt-":"Ctrl-";c[b[j+"Up"]="scrollLineUp"]=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top+b.clientHeight,"local");if(a.getCursor().line>=c)a.execCommand("goLineUp")}a.scrollTo(null,b.top-a.defaultTextHeight())};c[b[j+"Down"]="scrollLineDown"]=function(a){var b=a.getScrollInfo();if(!a.somethingSelected()){var c=a.lineAtHeight(b.top,"local")+1;if(a.getCursor().line<=c)a.execCommand("goLineDown")}a.scrollTo(null,b.top+a.defaultTextHeight())};c[b["Shift-"+f+"L"]="splitSelectionByLine"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e].from(),g=b[e].to();for(var h=f.line;h<=g.line;++h)if(!(g.line>f.line&&h==g.line&&g.ch==0))c.push({anchor:h==f.line?f:d(h,0),head:h==g.line?g:d(h)})}a.setSelections(c,0)};b["Shift-Tab"]="indentLess";c[b["Esc"]="singleSelectionTop"]=function(a){var b=a.listSelections()[0];a.setSelection(b.anchor,b.head,{scroll:false})};c[b[f+"L"]="selectLine"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e];c.push({anchor:d(f.from().line,0),head:d(f.to().line+1,0)})}a.setSelections(c)};b["Shift-Ctrl-K"]="deleteLine";function k(b,c){if(b.isReadOnly())return a.Pass;b.operation(function(){var a=b.listSelections().length,e=[],f=-1;for(var g=0;g<a;g++){var h=b.listSelections()[g].head;if(h.line<=f)continue;var i=d(h.line+(c?0:1),0);b.replaceRange("\n",i,null,"+insertLine");b.indentLine(i.line,null,true);e.push({head:i,anchor:i});f=h.line+1}b.setSelections(e)});b.execCommand("indentAuto")}c[b[f+"Enter"]="insertLineAfter"]=function(a){return k(a,false)};c[b["Shift-"+f+"Enter"]="insertLineBefore"]=function(a){return k(a,true)};function l(b,c){var e=c.ch,f=e,g=b.getLine(c.line);while(e&&a.isWordChar(g.charAt(e-1)))--e;while(f<g.length&&a.isWordChar(g.charAt(f)))++f;return{from:d(c.line,e),to:d(c.line,f),word:g.slice(e,f)}}c[b[f+"D"]="selectNextOccurrence"]=function(b){var c=b.getCursor("from"),e=b.getCursor("to");var f=b.state.sublimeFindFullWord==b.doc.sel;if(a.cmpPos(c,e)==0){var g=l(b,c);if(!g.word)return;b.setSelection(g.from,g.to);f=true}else{var h=b.getRange(c,e);var i=f?new RegExp("\\b"+h+"\\b"):h;var j=b.getSearchCursor(i,e);var k=j.findNext();if(!k){j=b.getSearchCursor(i,d(b.firstLine(),0));k=j.findNext()}if(!k||m(b.listSelections(),j.from(),j.to()))return a.Pass;b.addSelection(j.from(),j.to())}if(f)b.state.sublimeFindFullWord=b.doc.sel};function m(a,b,c){for(var d=0;d<a.length;d++)if(a[d].from()==b&&a[d].to()==c)return true;return false}var n="(){}[]";function o(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e],g=f.head,h=a.scanForBracket(g,-1);if(!h)return false;for(;;){var i=a.scanForBracket(g,1);if(!i)return false;if(i.ch==n.charAt(n.indexOf(h.ch)+1)){c.push({anchor:d(h.pos.line,h.pos.ch+1),head:i.pos});break}g=d(i.pos.line,i.pos.ch+1)}}a.setSelections(c);return true}c[b["Shift-"+f+"Space"]="selectScope"]=function(a){o(a)||a.execCommand("selectAll")};c[b["Shift-"+f+"M"]="selectBetweenBrackets"]=function(b){if(!o(b))return a.Pass};c[b[f+"M"]="goToBracket"]=function(b){b.extendSelectionsBy(function(c){var e=b.scanForBracket(c.head,1);if(e&&a.cmpPos(e.pos,c.head)!=0)return e.pos;var f=b.scanForBracket(c.head,-1);return f&&d(f.pos.line,f.pos.ch+1)||c.head})};var p=e?"Cmd-Ctrl-":"Shift-Ctrl-";c[b[p+"Up"]="swapLineUp"]=function(b){if(b.isReadOnly())return a.Pass;var c=b.listSelections(),e=[],f=b.firstLine()-1,g=[];for(var h=0;h<c.length;h++){var i=c[h],j=i.from().line-1,k=i.to().line;g.push({anchor:d(i.anchor.line-1,i.anchor.ch),head:d(i.head.line-1,i.head.ch)});if(i.to().ch==0&&!i.empty())--k;if(j>f)e.push(j,k);else if(e.length)e[e.length-1]=k;f=k}b.operation(function(){for(var a=0;a<e.length;a+=2){var c=e[a],f=e[a+1];var h=b.getLine(c);b.replaceRange("",d(c,0),d(c+1,0),"+swapLine");if(f>b.lastLine())b.replaceRange("\n"+h,d(b.lastLine()),null,"+swapLine");else b.replaceRange(h+"\n",d(f,0),null,"+swapLine")}b.setSelections(g);b.scrollIntoView()})};c[b[p+"Down"]="swapLineDown"]=function(b){if(b.isReadOnly())return a.Pass;var c=b.listSelections(),e=[],f=b.lastLine()+1;for(var g=c.length-1;g>=0;g--){var h=c[g],i=h.to().line+1,j=h.from().line;if(h.to().ch==0&&!h.empty())i--;if(i<f)e.push(i,j);else if(e.length)e[e.length-1]=j;f=j}b.operation(function(){for(var a=e.length-2;a>=0;a-=2){var c=e[a],f=e[a+1];var g=b.getLine(c);if(c==b.lastLine())b.replaceRange("",d(c-1),d(c),"+swapLine");else b.replaceRange("",d(c,0),d(c+1,0),"+swapLine");b.replaceRange(g+"\n",d(f,0),null,"+swapLine")}b.scrollIntoView()})};c[b[f+"/"]="toggleCommentIndented"]=function(a){a.toggleComment({indent:true})};c[b[f+"J"]="joinLines"]=function(a){var b=a.listSelections(),c=[];for(var e=0;e<b.length;e++){var f=b[e],g=f.from();var h=g.line,i=f.to().line;while(e<b.length-1&&b[e+1].from().line==i)i=b[++e].to().line;c.push({start:h,end:i,anchor:!f.empty()&&g})}a.operation(function(){var b=0,e=[];for(var f=0;f<c.length;f++){var g=c[f];var h=g.anchor&&d(g.anchor.line-b,g.anchor.ch),i;for(var j=g.start;j<=g.end;j++){var k=j-b;if(j==g.end)i=d(k,a.getLine(k).length+1);if(k<a.lastLine()){a.replaceRange(" ",d(k),d(k+1,/^\s*/.exec(a.getLine(k+1))[0].length));++b}}e.push({anchor:h||i,head:i})}a.setSelections(e,0)})};c[b["Shift-"+f+"D"]="duplicateLine"]=function(a){a.operation(function(){var b=a.listSelections().length;for(var c=0;c<b;c++){var e=a.listSelections()[c];if(e.empty())a.replaceRange(a.getLine(e.head.line)+"\n",d(e.head.line,0));else a.replaceRange(a.getRange(e.from(),e.to()),e.from())}a.scrollIntoView()})};if(!e)b[f+"T"]="transposeChars";function q(b,c){if(b.isReadOnly())return a.Pass;var e=b.listSelections(),f=[],g;for(var h=0;h<e.length;h++){var i=e[h];if(i.empty())continue;var j=i.from().line,k=i.to().line;while(h<e.length-1&&e[h+1].from().line==k)k=e[++h].to().line;if(!e[h].to().ch)k--;f.push(j,k)}if(f.length)g=true;else f.push(b.firstLine(),b.lastLine());b.operation(function(){var a=[];for(var e=0;e<f.length;e+=2){var h=f[e],i=f[e+1];var j=d(h,0),k=d(i);var l=b.getRange(j,k,false);if(c)l.sort();else l.sort(function(a,b){var c=a.toUpperCase(),d=b.toUpperCase();if(c!=d){a=c;b=d}return a<b?-1:a==b?0:1});b.replaceRange(l,j,k);if(g)a.push({anchor:j,head:d(i+1,0)})}if(g)b.setSelections(a,0)})}c[b["F9"]="sortLines"]=function(a){q(a,true)};c[b[f+"F9"]="sortLinesInsensitive"]=function(a){q(a,false)};c[b["F2"]="nextBookmark"]=function(a){var b=a.state.sublimeBookmarks;if(b)while(b.length){var c=b.shift();var d=c.find();if(d){b.push(c);return a.setSelection(d.from,d.to)}}};c[b["Shift-F2"]="prevBookmark"]=function(a){var b=a.state.sublimeBookmarks;if(b)while(b.length){b.unshift(b.pop());var c=b[b.length-1].find();if(!c)b.pop();else return a.setSelection(c.from,c.to)}};c[b[f+"F2"]="toggleBookmark"]=function(a){var b=a.listSelections();var c=a.state.sublimeBookmarks||(a.state.sublimeBookmarks=[]);for(var d=0;d<b.length;d++){var e=b[d].from(),f=b[d].to();var g=a.findMarks(e,f);for(var h=0;h<g.length;h++){if(g[h].sublimeBookmark){g[h].clear();for(var i=0;i<c.length;i++)if(c[i]==g[h])c.splice(i--,1);break}}if(h==g.length)c.push(a.markText(e,f,{sublimeBookmark:true,clearWhenEmpty:false}))}};c[b["Shift-"+f+"F2"]="clearBookmarks"]=function(a){var b=a.state.sublimeBookmarks;if(b)for(var c=0;c<b.length;c++)b[c].clear();b.length=0};c[b["Alt-F2"]="selectBookmarks"]=function(a){var b=a.state.sublimeBookmarks,c=[];if(b)for(var d=0;d<b.length;d++){var e=b[d].find();if(!e)b.splice(d--,0);else c.push({anchor:e.from,head:e.to})}if(c.length)a.setSelections(c,0)};b["Alt-Q"]="wrapLines";var r=f+"K ";function s(b,c){b.operation(function(){var d=b.listSelections(),e=[],f=[];for(var g=0;g<d.length;g++){var h=d[g];if(h.empty()){e.push(g);f.push("")}else f.push(c(b.getRange(h.from(),h.to())))}b.replaceSelections(f,"around","case");for(var g=e.length-1,i;g>=0;g--){var h=d[e[g]];if(i&&a.cmpPos(h.head,i)>0)continue;var j=l(b,h.head);i=j.from;b.replaceRange(c(j.word),j.from,j.to)}})}b[r+f+"Backspace"]="delLineLeft";c[b["Backspace"]="smartBackspace"]=function(b){if(b.somethingSelected())return a.Pass;b.operation(function(){var c=b.listSelections();var e=b.getOption("indentUnit");for(var f=c.length-1;f>=0;f--){var g=c[f].head;var h=b.getRange({line:g.line,ch:0},g);var i=a.countColumn(h,null,b.getOption("tabSize"));var j=b.findPosH(g,-1,"char",false);if(h&&!/\S/.test(h)&&i%e==0){var k=new d(g.line,a.findColumn(h,i-e,e));if(k.ch!=g.ch)j=k}b.replaceRange("",j,g,"+delete")}})};c[b[r+f+"K"]="delLineRight"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=b.length-1;c>=0;c--)a.replaceRange("",b[c].anchor,d(b[c].to().line),"+delete");a.scrollIntoView()})};c[b[r+f+"U"]="upcaseAtCursor"]=function(a){s(a,function(a){return a.toUpperCase()})};c[b[r+f+"L"]="downcaseAtCursor"]=function(a){s(a,function(a){return a.toLowerCase()})};c[b[r+f+"Space"]="setSublimeMark"]=function(a){if(a.state.sublimeMark)a.state.sublimeMark.clear();a.state.sublimeMark=a.setBookmark(a.getCursor())};c[b[r+f+"A"]="selectToSublimeMark"]=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();if(b)a.setSelection(a.getCursor(),b)};c[b[r+f+"W"]="deleteToSublimeMark"]=function(b){var c=b.state.sublimeMark&&b.state.sublimeMark.find();if(c){var d=b.getCursor(),e=c;if(a.cmpPos(d,e)>0){var f=e;e=d;d=f}b.state.sublimeKilled=b.getRange(d,e);b.replaceRange("",d,e)}};c[b[r+f+"X"]="swapWithSublimeMark"]=function(a){var b=a.state.sublimeMark&&a.state.sublimeMark.find();if(b){a.state.sublimeMark.clear();a.state.sublimeMark=a.setBookmark(a.getCursor());a.setCursor(b)}};c[b[r+f+"Y"]="sublimeYank"]=function(a){if(a.state.sublimeKilled!=null)a.replaceSelection(a.state.sublimeKilled,null,"paste")};b[r+f+"G"]="clearBookmarks";c[b[r+f+"C"]="showInCenter"]=function(a){var b=a.cursorCoords(null,"local");a.scrollTo(null,(b.top+b.bottom)/2-a.getScrollInfo().clientHeight/2)};var t=e?"Ctrl-Shift-":"Ctrl-Alt-";c[b[t+"Up"]="selectLinesUpward"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=0;c<b.length;c++){var e=b[c];if(e.head.line>a.firstLine())a.addSelection(d(e.head.line-1,e.head.ch))}})};c[b[t+"Down"]="selectLinesDownward"]=function(a){a.operation(function(){var b=a.listSelections();for(var c=0;c<b.length;c++){var e=b[c];if(e.head.line<a.lastLine())a.addSelection(d(e.head.line+1,e.head.ch))}})};function u(b){var c=b.getCursor("from"),d=b.getCursor("to");if(a.cmpPos(c,d)==0){var e=l(b,c);if(!e.word)return;c=e.from;d=e.to}return{from:c,to:d,query:b.getRange(c,d),word:e}}function v(a,b){var c=u(a);if(!c)return;var e=c.query;var f=a.getSearchCursor(e,b?c.to:c.from);if(b?f.findNext():f.findPrevious()){a.setSelection(f.from(),f.to())}else{f=a.getSearchCursor(e,b?d(a.firstLine(),0):a.clipPos(d(a.lastLine())));if(b?f.findNext():f.findPrevious())a.setSelection(f.from(),f.to());else if(c.word)a.setSelection(c.from,c.to)}}c[b[f+"F3"]="findUnder"]=function(a){v(a,true)};c[b["Shift-"+f+"F3"]="findUnderPrevious"]=function(a){v(a,false)};c[b["Alt-F3"]="findAllUnder"]=function(a){var b=u(a);if(!b)return;var c=a.getSearchCursor(b.query);var d=[];var e=-1;while(c.findNext()){d.push({anchor:c.from(),head:c.to()});if(c.from().line<=b.from.line&&c.from().ch<=b.from.ch)e++}a.setSelections(d,e)};b["Shift-"+f+"["]="fold";b["Shift-"+f+"]"]="unfold";b[r+f+"0"]=b[r+f+"J"]="unfoldAll";b[f+"I"]="findIncremental";b["Shift-"+f+"I"]="findIncrementalReverse";b[f+"H"]="replace";b["F3"]="findNext";b["Shift-F3"]="findPrev";a.normalizeKeyMap(b)});
//# sourceMappingURL=sublime.min.js.map