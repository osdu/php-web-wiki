(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../htmlmixed/htmlmixed"],a);else a(CodeMirror)})(function(a){"use strict";var b=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];a.defineMode("soy",function(c){var d=a.getMode(c,"text/plain");var e={html:a.getMode(c,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:false}),attributes:d,text:d,uri:d,css:a.getMode(c,"text/css"),js:a.getMode(c,{name:"text/javascript",statementIndent:2*c.indentUnit})};function f(a){return a[a.length-1]}function g(a,b,c){if(a.sol()){for(var d=0;d<b.indent;d++){if(!a.eat(/\s/))break}if(d)return null}var e=a.string;var g=c.exec(e.substr(a.pos));if(g){a.string=e.substr(0,a.pos+g.index)}var h=a.hideFirstChars(b.indent,function(){var c=f(b.localStates);return c.mode.token(a,c.state)});a.string=e;return h}function h(a,b){while(a){if(a.element===b)return true;a=a.next}return false}function i(a,b){return{element:b,next:a}}function j(a,b,c){return h(a,b)?"variable-2":c?"variable":"variable-2 error"}function k(a){if(a.scopes){a.variables=a.scopes.element;a.scopes=a.scopes.next}}return{startState:function(){return{kind:[],kindTag:[],soyState:[],templates:null,variables:null,scopes:null,indent:0,localStates:[{mode:e.html,state:a.startState(e.html)}]}},copyState:function(b){return{tag:b.tag,kind:b.kind.concat([]),kindTag:b.kindTag.concat([]),soyState:b.soyState.concat([]),templates:b.templates,variables:b.variables,scopes:b.scopes,indent:b.indent,localStates:b.localStates.map(function(b){return{mode:b.mode,state:a.copyState(b.mode,b.state)}})}},token:function(d,h){var l;switch(f(h.soyState)){case"comment":if(d.match(/^.*?\*\//)){h.soyState.pop()}else{d.skipToEnd()}return"comment";case"templ-def":if(l=d.match(/^\.?([\w]+(?!\.[\w]+)*)/)){h.templates=i(h.templates,l[1]);h.scopes=i(h.scopes,h.variables);h.soyState.pop();return"def"}d.next();return null;case"templ-ref":if(l=d.match(/^\.?([\w]+)/)){h.soyState.pop();if(l[0][0]=="."){return j(h.templates,l[1],true)}return"variable"}d.next();return null;case"param-def":if(l=d.match(/^\w+/)){h.variables=i(h.variables,l[0]);h.soyState.pop();h.soyState.push("param-type");return"def"}d.next();return null;case"param-type":if(d.peek()=="}"){h.soyState.pop();return null}if(d.eatWhile(/^[\w]+/)){return"variable-3"}d.next();return null;case"var-def":if(l=d.match(/^\$([\w]+)/)){h.variables=i(h.variables,l[1]);h.soyState.pop();return"def"}d.next();return null;case"tag":if(d.match(/^\/?}/)){if(h.tag=="/template"||h.tag=="/deltemplate"){k(h);h.indent=0}else{if(h.tag=="/for"||h.tag=="/foreach"){k(h)}h.indent-=c.indentUnit*(d.current()=="/}"||b.indexOf(h.tag)==-1?2:1)}h.soyState.pop();return"keyword"}else if(d.match(/^([\w?]+)(?==)/)){if(d.current()=="kind"&&(l=d.match(/^="([^"]+)/,false))){var m=l[1];h.kind.push(m);h.kindTag.push(h.tag);var n=e[m]||e.html;var o=f(h.localStates);if(o.mode.indent){h.indent+=o.mode.indent(o.state,"")}h.localStates.push({mode:n,state:a.startState(n)})}return"attribute"}else if(d.match(/^"/)){h.soyState.push("string");return"string"}if(l=d.match(/^\$([\w]+)/)){return j(h.variables,l[1])}if(l=d.match(/^\w+/)){return/^(?:as|and|or|not|in)$/.test(l[0])?"keyword":null}d.next();return null;case"literal":if(d.match(/^(?=\{\/literal})/)){h.indent-=c.indentUnit;h.soyState.pop();return this.token(d,h)}return g(d,h,/\{\/literal}/);case"string":var l=d.match(/^.*?("|\\[\s\S])/);if(!l){d.skipToEnd()}else if(l[1]=='"'){h.soyState.pop()}return"string"}if(d.match(/^\/\*/)){h.soyState.push("comment");return"comment"}else if(d.match(d.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)){return"comment"}else if(d.match(/^\{literal}/)){h.indent+=c.indentUnit;h.soyState.push("literal");return"keyword"}else if(l=d.match(/^\{([\/@\\]?[\w?]*)/)){if(l[1]!="/switch")h.indent+=(/^(\/|(else|elseif|ifempty|case|fallbackmsg|default)$)/.test(l[1])&&h.tag!="switch"?1:2)*c.indentUnit;h.tag=l[1];if(h.tag=="/"+f(h.kindTag)){h.kind.pop();h.kindTag.pop();h.localStates.pop();var o=f(h.localStates);if(o.mode.indent){h.indent-=o.mode.indent(o.state,"")}}h.soyState.push("tag");if(h.tag=="template"||h.tag=="deltemplate"){h.soyState.push("templ-def")}if(h.tag=="call"||h.tag=="delcall"){h.soyState.push("templ-ref")}if(h.tag=="let"){h.soyState.push("var-def")}if(h.tag=="for"||h.tag=="foreach"){h.scopes=i(h.scopes,h.variables);h.soyState.push("var-def")}if(h.tag.match(/^@(?:param\??|inject)/)){h.soyState.push("param-def")}return"keyword"}return g(d,h,/\{|\s+\/\/|\/\*/)},indent:function(b,d){var e=b.indent,g=f(b.soyState);if(g=="comment")return a.Pass;if(g=="literal"){if(/^\{\/literal}/.test(d))e-=c.indentUnit}else{if(/^\s*\{\/(template|deltemplate)\b/.test(d))return 0;if(/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(d))e-=c.indentUnit;if(b.tag!="switch"&&/^\{(case|default)\b/.test(d))e-=c.indentUnit;if(/^\{\/switch\b/.test(d))e-=c.indentUnit}var h=f(b.localStates);if(e&&h.mode.indent){e+=h.mode.indent(h.state,d)}return e},innerMode:function(a){if(a.soyState.length&&f(a.soyState)!="literal")return null;else return f(a.localStates)},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",useInnerComments:false,fold:"indent"}},"htmlmixed");a.registerHelper("hintWords","soy",b.concat(["delpackage","namespace","alias","print","css","debugger"]));a.defineMIME("text/x-soy","soy")});
//# sourceMappingURL=soy.min.js.map